@using ProjectManager.Components.Common
@using ProjectManager.Components.Modals.Modal

<ModalDialog @ref="_modalDialog" Height="800px" Width="1200px">
    <ModalDialogHeader>
        <h5 class="task-modal-header">
            <span class="badge text-bg-secondary">@_task?.Status.ToString()</span> @_task.Title
        </h5>
    </ModalDialogHeader>
    <ModalDialogBody>
        <SplitPane MinLeft="200" MinRight="200" InitialLeftRatio="0.6">
            <Left>
                <div style="padding: 1rem; height: 100%; display: flex; flex-direction: column; overflow-y: hidden">
                    @if (_task is null)
                    {
                        <p>Loading…</p>
                    }
                    else
                    {
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h6>Description:</h6>
                            @if (!_editMode && _canModify)
                            {
                                <i class="bi bi-pencil-square open-edit-task-modal"
                                   @onclick="@(() => _editMode = true)"
                                   title="Edit description"></i>
                            }

                        </div>
                        @if (_editMode)
                        {
                            <EditForm Model="_model" OnValidSubmit="Save">
                                <DataAnnotationsValidator/>
                                <InputTextArea @bind-Value="_model.DescriptionMarkdown" class="form-control mb-3" rows="4"/>
                                <button type="button" class="btn btn-outline-secondary" @onclick="@(() => _editMode = false)">Cancel</button>
                                <button class="btn btn-primary" disabled="@(!_canModify)">Save</button>
                            </EditForm>
                        }
                        else
                        {
                            <div>
                                @(_model.DescriptionMarkdown)
                            </div>
                        }

                        <hr/>
                        <TaskAttachments Task="@_task" CanModify="_canModify"/>
                    }
                </div>
            </Left>
            <Right>
                <div style="padding: 1rem; height: 100%; background-color: #f8f9fa; border-left: 1px solid #e5e7eb; border-radius: 0 0.5rem 0.5rem 0; overflow-y: hidden">
                    @if (_task is not null)
                    {
                        <CommentsThread TaskId="_task.Id"/>
                    }
                </div>
            </Right>
        </SplitPane>
    </ModalDialogBody>
    <ModalDialogFooter>
        <span class="task-modal-error">@(_error ?? string.Empty)</span>
    </ModalDialogFooter>
</ModalDialog>

@code {
    
}
